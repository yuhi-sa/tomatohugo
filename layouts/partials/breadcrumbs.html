{{/*
  Breadcrumb Navigation Component
  
  Displays hierarchical navigation breadcrumbs for the current page.
  - Generates a breadcrumb trail from the homepage to the current page.
  - Includes Schema.org structured data for enhanced SEO.
  - Uses BEM class names for maintainable and themeable styling.
  
  @context {Page} . The current page context.
  @returns {string} HTML <nav> element containing the breadcrumb list.
*/}}

<nav aria-label="Breadcrumb navigation" role="navigation">
  {{/* The <ol> element represents the list of breadcrumbs.
       itemscope and itemtype define it as a Schema.org BreadcrumbList. */}}
  <ol class="breadcrumbs" itemscope itemtype="https://schema.org/BreadcrumbList">
    
    {{/* Step 1: Always add the "Home" breadcrumb as the first item.
         It's the root of the navigation trail. The position is hardcoded to 1. */}}
    <li class="breadcrumbs__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
      <a href="{{ "/" | relLangURL }}" class="breadcrumbs__link" itemprop="item" aria-label="Navigate to homepage">
        <i class="fas fa-home" aria-hidden="true"></i>
        <span itemprop="name">{{ .Site.Title | default "Home" }}</span>
      </a>
      <meta itemprop="position" content="1" />
    </li>
    
    {{/* Step 2: If the current page is not the homepage, generate the trail. */}}
    {{- if not .IsHome }}
      {{/* Loop through the page's ancestors (e.g., sections).
           .Ancestors provides the path from the content root. We .Reverse it to get the
           correct order from Home -> Section -> Sub-section. */}}
      {{- range $index, $ancestor := .Ancestors.Reverse }}
        {{- if and $ancestor.Title (ne $ancestor.Title "") }}
        <li class="breadcrumbs__item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="{{ $ancestor.Permalink }}" class="breadcrumbs__link" itemprop="item" aria-label="Navigate to {{ $ancestor.Title }}">
            <span itemprop="name">{{ $ancestor.Title }}</span>
          </a>
          {{/* The position starts from 2 because "Home" is 1.
               We add the loop index to 2 to get the correct position. */}}
          <meta itemprop="position" content="{{ add $index 2 }}" />
        </li>
        {{- end }}
      {{- end }}
      
      {{/* Step 3: Add the current page as the final item in the breadcrumb trail.
           It is not a link, as it represents the page the user is currently on. */}}
      {{- with .Title }}
      <li class="breadcrumbs__item" aria-current="page" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <span itemprop="name">{{ . }}</span>
        {{/* The final position is the number of ancestors + 2 (for Home and the current page itself). */}}
        <meta itemprop="position" content="{{ add (len $.Ancestors) 2 }}" />
      </li>
      {{- end }}
    {{- end }}
    
  </ol>
</nav>